---
layout: post
title:  "色彩空间入门"
date:   2018-07-26 11:55:59 +0800
category: 多媒体开发
---

## 从颜色说起

色彩，也称为颜色。既然要说色彩空间，就要先了解什么是颜色。
![](https://dlseeu-website.oss-cn-hangzhou.aliyuncs.com/%E8%89%B2%E5%BD%A9%E6%A8%A1%E5%9E%8B-RGB.png)

在我们自然界中，我们发现按照颜色产生机制的不同，可以归类为两种，一类是**光源色**，这类物体本生是主发射光的，比如太阳，灯泡，显示器; 另外一类是**表面色**，这类物体本身不发光，但是他们吸收光波，剩余的光波被反射后就决定了物体的颜色，比如课本，家具等。

人类要自定义产生颜色，就要有混色机制，根据上述的机制差别，发明了**三原色加法混色**和**三原色减法混色**两种方法。

三原色加法混色，使用RGB三种人类敏感的颜色，进行混合得到颜色，如果是等量将会得到白色。显示器就是三个电子束通过不同的强度来轰击不同颜色的磷光粉，来生成不同的颜色光谱。 三原色如果是等量混合，理论上是白色。
![](https://dlseeu-website.oss-cn-hangzhou.aliyuncs.com/%E5%85%89%E6%BA%90%E8%89%B2%E4%B8%89%E5%8E%9F%E8%89%B2.png)

三原色减法混色，相对于三原色加法混色，减法混色是因为反向考虑吸收，所以减法混色不是使用RGB，而是使用他们补色的CMY，如果三个等量混合，理论上是黑色。在绘图和印刷行业里，都是使用这种调色方法。
![](https://dlseeu-website.oss-cn-hangzhou.aliyuncs.com/CYMK.png)

## 色彩模型和色彩空间

所谓色彩模型，就是指用一定的规则来描述（排列）颜色的方法，比如RGB/CMYK/LAB等。

![色彩模型](https://dlseeu-website.oss-cn-hangzhou.aliyuncs.com/%E8%89%B2%E5%BD%A9%E6%A8%A1%E5%9E%8B-RGB.png)

色彩模型指规定了方法，但并没有对坐标系的数值做规定，比如RGB(255,0,0)表示为最红的红色，但这个红色如何换算到人类可以感知的波长和亮度，并没有明确。而色彩空间就是对模型进行确切的定义。

一个色彩模型可以有不同的色彩空间，比如RGB色彩模型就有sRGB/AdobeRGB等色彩空间，sRGB规定了最大红色的为CIE XYZ: 0.4360657, 0.2224884, 0.013916。而 CIE XYZ 是一个特殊的色彩空间，根据人眼三刺激值实验测试结果而建立。

不同的色彩空间有不同的覆盖色域，也就是表达的颜色范围不同。比如AdobeRGB的色域比sRGB要大

## YUV

YUV出现在黑白电视到彩色电视的过渡期间。在摄像机采集到设备后，通过矩阵转换后得到YUV的分量信号，这样如果是黑白电视，只接收处理Y信号就可以看黑白电视了，如果是彩色电视，那么街上UV色差分量，就可以看到彩色电视。

人类视觉系统中有杆状细胞和锥状细胞，杆状细胞对亮度敏感，锥状细胞对颜色敏感。人的眼睛对亮度的敏感度和对颜色的敏感度是不一样的，对亮度更加敏感些，所以在YUV信号的处理中，可以通过抽样方法来降低UV的比例，但是却可以欺骗眼睛让它感觉不到。

YUV最原始的数据就是YUV444, 通过水平抽样一次就是YUV422, 如果垂直方向再抽象一次就是YUV420

![YUV-Formats](https://dlseeu-website.oss-cn-hangzhou.aliyuncs.com/YUV-Formats.png)

由于YUV420的带宽占用最小，所以也是最流行的格式。带宽相对于RGB来说节省了一半。

数据有了，数据如何存储又形成了不同的格式：

- 紧缩格式(poacket formats): 将Y、U、V值存储成Macro Pixels数组，和RGB的存放方式类似。
- 平面格式(planar formats): 将Y、U、V的三个分量分别存放在不同的矩阵中

紧缩格式（packed format）中的YUV是混合在一起的，对于YUV4:4:4格式而言，用紧缩格式很合适的，因此就有了UYVY、YUYV等。

平面格式（planar formats）是指每Y分量，U分量和V分量都是以独立的平面组织的，也就是说所有的U分量必须在Y分量后面，而V分量在所有的U分量后面，此一格式适用于采样（subsample）。平面格式（planar format）有I420（4:2:0）、YV12、IYUV等

![存储格式](https://dlseeu-website.oss-cn-hangzhou.aliyuncs.com/%E8%89%B2%E5%BD%A9%E6%A8%A1%E5%9E%8B-RGB.png)

## YUV和RGB的转换
```
Y = 0.299 ∗ R + 0.587 ∗ G + 0.114 ∗ B	
U = − 0.169 ∗ R − 0.331 ∗ G + 0.5 ∗ B + 128	
V = 0.5 ∗ R − 0.419 ∗ G − 0.081 ∗ B + 128


R & = Y + 1.13983 * (V - 128) 
G & = Y - 0.39465 * (U - 128) - 0.58060 * (V - 128) 
B & = Y + 2.03211 * (U - 128)
```

